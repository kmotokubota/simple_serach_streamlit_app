-- ========================================
-- 1.環境構築
-- ========================================
create or replace database application_db;
create or replace schema application_db.application_schema;
use schema application_db.application_schema;

-- ========================================
-- 2.バックエンドテーブル作成
-- ========================================
-- 定型検索のバックエンドテーブル
create or replace TABLE STANDARD_SEARCH_OBJECTS (
	OBJECT_ID VARCHAR(16777216),
	OBJECT_NAME VARCHAR(16777216),
	DESCRIPTION VARCHAR(16777216),
	SEARCH_QUERY VARCHAR(16777216),
	CREATED_BY VARCHAR(16777216)DEFAULT CURRENT_USER(),
	CREATED_AT TIMESTAMP_NTZ(9) DEFAULT CURRENT_TIMESTAMP(),
	UPDATED_AT TIMESTAMP_NTZ(9) DEFAULT CURRENT_TIMESTAMP(),
	IS_FAVORITE BOOLEAN DEFAULT FALSE,
	EXECUTION_COUNT NUMBER(38,0) DEFAULT 0,
	LAST_EXECUTED TIMESTAMP_NTZ(9)
);

-- 非定型検索のバックエンドテーブル
CREATE OR REPLACE TABLE ADHOC_SEARCH_OBJECTS (
	OBJECT_ID VARCHAR(16777216),
	OBJECT_NAME VARCHAR(16777216),
	DESCRIPTION VARCHAR(16777216),
	TABLE1_NAME VARCHAR(16777216),
	TABLE2_NAME VARCHAR(16777216),
	JOIN_TYPE VARCHAR(100),
	JOIN_KEY1 VARCHAR(16777216),
	JOIN_KEY2 VARCHAR(16777216),
	SEARCH_QUERY VARCHAR(16777216),
	CREATED_BY VARCHAR(16777216) DEFAULT CURRENT_USER(),
	CREATED_AT TIMESTAMP_NTZ(9) DEFAULT CURRENT_TIMESTAMP(),
	UPDATED_AT TIMESTAMP_NTZ(9) DEFAULT CURRENT_TIMESTAMP(),
	IS_FAVORITE BOOLEAN DEFAULT FALSE,
	EXECUTION_COUNT NUMBER(38,0) DEFAULT 0,
	LAST_EXECUTED TIMESTAMP_NTZ(9)
);

-- お知らせ管理テーブル
CREATE OR REPLACE TABLE ANNOUNCEMENTS (
    ANNOUNCEMENT_ID NUMBER AUTOINCREMENT,
    TITLE VARCHAR(500),
    MESSAGE VARCHAR(5000),
    ANNOUNCEMENT_TYPE VARCHAR(50), -- 'info', 'warning', 'error', 'success'
    PRIORITY NUMBER DEFAULT 99, -- 数字が小さいほど優先度高
    START_DATE DATE,
    END_DATE DATE,
    SHOW_FLAG BOOLEAN DEFAULT TRUE,
    CREATED_AT TIMESTAMP_NTZ DEFAULT CURRENT_TIMESTAMP(),
    CREATED_BY VARCHAR(100) DEFAULT CURRENT_USER(),
    PRIMARY KEY (ANNOUNCEMENT_ID)
);

-- デモ用お知らせデータ
INSERT INTO ANNOUNCEMENTS (TITLE, MESSAGE, ANNOUNCEMENT_TYPE, PRIORITY, START_DATE, END_DATE, SHOW_FLAG)
VALUES 
('デモアプリへようこそ', 'このアプリはネット銀行のデータ分析デモです。定型検索機能をお試しください。', 'info', 1, CURRENT_DATE(), DATEADD(month, 6, CURRENT_DATE()), TRUE);

-- ========================================
-- デモ用データ: ネット銀行シナリオ
-- ========================================

--データベース作成 
create or replace database bank_db ;
create or replace schema bank_db.bank_schema;
use schema bank_db.bank_schema; 

-- 顧客テーブル
CREATE OR REPLACE TABLE CUSTOMER (
    CUSTOMER_ID VARCHAR(20) PRIMARY KEY,
    CUSTOMER_NAME VARCHAR(100),
    CUSTOMER_NAME_KANA VARCHAR(100),
    AGE NUMBER,
    GENDER VARCHAR(10),
    PREFECTURE VARCHAR(20),
    CITY VARCHAR(50),
    CUSTOMER_SEGMENT VARCHAR(50), -- 'プレミアム', 'スタンダード', '新規'
    REGISTRATION_DATE DATE,
    ACCOUNT_STATUS VARCHAR(20) -- 'アクティブ', '休眠', '解約'
);

-- 取引テーブル
CREATE OR REPLACE TABLE TRANSACTION (
    TRANSACTION_ID VARCHAR(50) PRIMARY KEY,
    CUSTOMER_ID VARCHAR(20),
    TRANSACTION_DATE DATE,
    TRANSACTION_TYPE VARCHAR(50), -- '入金', '出金', '振込', '定期預金', '投資信託'
    AMOUNT NUMBER(15,2),
    BALANCE_AFTER NUMBER(15,2), -- 取引後残高
    CHANNEL VARCHAR(30), -- 'Web', 'モバイルアプリ', 'ATM', 'コールセンター'
    BRANCH_CODE VARCHAR(10),
    MEMO VARCHAR(500)
);

-- ========================================
-- デモデータ投入
-- ========================================

-- 顧客データ（50人）
INSERT INTO CUSTOMER VALUES
('C0001', '山田太郎', 'ヤマダタロウ', 35, '男性', '東京都', '千代田区', 'プレミアム', '2025-01-15', 'アクティブ'),
('C0002', '佐藤花子', 'サトウハナコ', 28, '女性', '大阪府', '大阪市', 'スタンダード', '2025-01-18', 'アクティブ'),
('C0003', '鈴木一郎', 'スズキイチロウ', 42, '男性', '神奈川県', '横浜市', 'プレミアム', '2025-01-20', 'アクティブ'),
('C0004', '田中美咲', 'タナカミサキ', 31, '女性', '愛知県', '名古屋市', 'スタンダード', '2025-01-22', 'アクティブ'),
('C0005', '高橋健太', 'タカハシケンタ', 26, '男性', '福岡県', '福岡市', '新規', '2025-01-25', 'アクティブ'),
('C0006', '伊藤愛', 'イトウアイ', 38, '女性', '北海道', '札幌市', 'プレミアム', '2025-02-01', 'アクティブ'),
('C0007', '渡辺誠', 'ワタナベマコト', 45, '男性', '東京都', '新宿区', 'スタンダード', '2025-02-05', 'アクティブ'),
('C0008', '中村さくら', 'ナカムラサクラ', 29, '女性', '京都府', '京都市', 'スタンダード', '2025-02-08', 'アクティブ'),
('C0009', '小林大輔', 'コバヤシダイスケ', 33, '男性', '埼玉県', 'さいたま市', '新規', '2025-02-10', 'アクティブ'),
('C0010', '加藤美香', 'カトウミカ', 40, '女性', '千葉県', '千葉市', 'プレミアム', '2025-02-12', 'アクティブ'),
('C0011', '吉田拓也', 'ヨシダタクヤ', 27, '男性', '広島県', '広島市', 'スタンダード', '2025-02-15', 'アクティブ'),
('C0012', '山口結衣', 'ヤマグチユイ', 34, '女性', '宮城県', '仙台市', 'スタンダード', '2025-02-18', 'アクティブ'),
('C0013', '松本隆', 'マツモトタカシ', 50, '男性', '東京都', '渋谷区', 'プレミアム', '2025-02-20', 'アクティブ'),
('C0014', '井上麻衣', 'イノウエマイ', 25, '女性', '静岡県', '静岡市', '新規', '2025-02-22', 'アクティブ'),
('C0015', '木村翔太', 'キムラショウタ', 36, '男性', '兵庫県', '神戸市', 'スタンダード', '2025-02-25', 'アクティブ'),
('C0016', '林優子', 'ハヤシユウコ', 43, '女性', '新潟県', '新潟市', 'プレミアム', '2025-03-01', 'アクティブ'),
('C0017', '斎藤健', 'サイトウケン', 32, '男性', '茨城県', '水戸市', 'スタンダード', '2025-03-05', 'アクティブ'),
('C0018', '清水彩', 'シミズアヤ', 30, '女性', '栃木県', '宇都宮市', '新規', '2025-03-08', 'アクティブ'),
('C0019', '森田浩二', 'モリタコウジ', 48, '男性', '岡山県', '岡山市', 'プレミアム', '2025-03-10', 'アクティブ'),
('C0020', '池田真理', 'イケダマリ', 37, '女性', '熊本県', '熊本市', 'スタンダード', '2025-03-12', 'アクティブ'),
('C0021', '石井大樹', 'イシイダイキ', 29, '男性', '群馬県', '前橋市', 'スタンダード', '2025-03-15', 'アクティブ'),
('C0022', '橋本香織', 'ハシモトカオリ', 41, '女性', '長野県', '長野市', 'プレミアム', '2025-03-18', 'アクティブ'),
('C0023', '山崎亮', 'ヤマザキリョウ', 26, '男性', '三重県', '津市', '新規', '2025-03-20', 'アクティブ'),
('C0024', '内藤優奈', 'ナイトウユウナ', 33, '女性', '滋賀県', '大津市', 'スタンダード', '2025-03-22', 'アクティブ'),
('C0025', '阿部誠一', 'アベセイイチ', 52, '男性', '東京都', '港区', 'プレミアム', '2025-03-25', 'アクティブ'),
('C0026', '前田沙織', 'マエダサオリ', 28, '女性', '奈良県', '奈良市', 'スタンダード', '2025-04-01', 'アクティブ'),
('C0027', '藤田健一', 'フジタケンイチ', 39, '男性', '和歌山県', '和歌山市', 'スタンダード', '2025-04-05', 'アクティブ'),
('C0028', '岡田梨花', 'オカダリカ', 24, '女性', '富山県', '富山市', '新規', '2025-04-08', 'アクティブ'),
('C0029', '後藤雄介', 'ゴトウユウスケ', 44, '男性', '石川県', '金沢市', 'プレミアム', '2025-04-10', 'アクティブ'),
('C0030', '長谷川舞', 'ハセガワマイ', 35, '女性', '福井県', '福井市', 'スタンダード', '2025-04-12', 'アクティブ'),
('C0031', '村上洋平', 'ムラカミヨウヘイ', 31, '男性', '山梨県', '甲府市', 'スタンダード', '2025-04-15', 'アクティブ'),
('C0032', '近藤絵美', 'コンドウエミ', 27, '女性', '岐阜県', '岐阜市', '新規', '2025-04-18', 'アクティブ'),
('C0033', '坂本達也', 'サカモトタツヤ', 46, '男性', '愛媛県', '松山市', 'プレミアム', '2025-04-20', 'アクティブ'),
('C0034', '遠藤あかり', 'エンドウアカリ', 30, '女性', '香川県', '高松市', 'スタンダード', '2025-04-22', 'アクティブ'),
('C0035', '青木隆', 'アオキタカシ', 38, '男性', '鹿児島県', '鹿児島市', 'スタンダード', '2025-04-25', 'アクティブ'),
('C0036', '西村美穂', 'ニシムラミホ', 32, '女性', '東京都', '品川区', 'スタンダード', '2025-05-01', 'アクティブ'),
('C0037', '平野勇太', 'ヒラノユウタ', 29, '男性', '大阪府', '堺市', 'スタンダード', '2025-05-05', 'アクティブ'),
('C0038', '福田莉子', 'フクダリコ', 26, '女性', '神奈川県', '川崎市', '新規', '2025-05-08', 'アクティブ'),
('C0039', '岩田翔', 'イワタショウ', 41, '男性', '愛知県', '豊田市', 'プレミアム', '2025-05-10', 'アクティブ'),
('C0040', '原田恵', 'ハラダメグミ', 36, '女性', '福岡県', '北九州市', 'スタンダード', '2025-05-12', 'アクティブ'),
('C0041', '安藤健', 'アンドウケン', 44, '男性', '北海道', '函館市', 'プレミアム', '2025-05-15', 'アクティブ'),
('C0042', '中島彩香', 'ナカジマアヤカ', 27, '女性', '京都府', '宇治市', 'スタンダード', '2025-05-18', 'アクティブ'),
('C0043', '杉山大地', 'スギヤマダイチ', 33, '男性', '埼玉県', '川口市', 'スタンダード', '2025-05-20', 'アクティブ'),
('C0044', '竹内由美', 'タケウチユミ', 39, '女性', '千葉県', '船橋市', 'プレミアム', '2025-05-22', 'アクティブ'),
('C0045', '野村俊介', 'ノムラシュンスケ', 28, '男性', '広島県', '福山市', 'スタンダード', '2025-05-25', 'アクティブ'),
('C0046', '川口真由美', 'カワグチマユミ', 31, '女性', '宮城県', '石巻市', 'スタンダード', '2025-06-01', 'アクティブ'),
('C0047', '上田徹', 'ウエダトオル', 47, '男性', '東京都', '世田谷区', 'プレミアム', '2025-06-05', 'アクティブ'),
('C0048', '菊地優', 'キクチユウ', 25, '女性', '静岡県', '浜松市', '新規', '2025-06-08', 'アクティブ'),
('C0049', '三浦健太郎', 'ミウラケンタロウ', 37, '男性', '兵庫県', '姫路市', 'スタンダード', '2025-06-10', 'アクティブ'),
('C0050', '小野寺さやか', 'オノデラサヤカ', 34, '女性', '新潟県', '長岡市', 'プレミアム', '2025-06-12', 'アクティブ');

-- 取引データ（150件）
INSERT INTO TRANSACTION VALUES
('T20250001', 'C0001', '2025-01-20', '入金', 500000.00, 500000.00, 'モバイルアプリ', 'BR001', '給与振込'),
('T20250002', 'C0002', '2025-01-22', '出金', 50000.00, 450000.00, 'ATM', 'BR002', '生活費'),
('T20250003', 'C0003', '2025-01-25', '定期預金', 1000000.00, 3500000.00, 'Web', 'BR001', '定期預金開設'),
('T20250004', 'C0004', '2025-01-28', '投資信託', 100000.00, 550000.00, 'Web', 'BR003', '投資信託購入'),
('T20250005', 'C0005', '2025-01-30', '入金', 300000.00, 300000.00, 'モバイルアプリ', 'BR004', '新規口座開設'),
('T20250006', 'C0006', '2025-02-02', '定期預金', 500000.00, 2800000.00, 'Web', 'BR001', '外貨預金開設'),
('T20250007', 'C0007', '2025-02-06', '振込', 80000.00, 720000.00, 'モバイルアプリ', 'BR001', '家賃支払い'),
('T20250008', 'C0008', '2025-02-10', '定期預金', 50000.00, 650000.00, 'Web', 'BR005', '積立定期開始'),
('T20250009', 'C0009', '2025-02-12', '入金', 250000.00, 250000.00, 'ATM', 'BR002', '初回入金'),
('T20250010', 'C0010', '2025-02-15', '投資信託', 200000.00, 3200000.00, 'Web', 'BR001', '海外株式投信購入'),
('T20250011', 'C0011', '2025-02-18', '入金', 280000.00, 580000.00, 'モバイルアプリ', 'BR006', '給与振込'),
('T20250012', 'C0012', '2025-02-20', '投資信託', 150000.00, 800000.00, 'Web', 'BR002', 'バランス型投信購入'),
('T20250013', 'C0013', '2025-02-22', '定期預金', 2000000.00, 8500000.00, 'Web', 'BR001', '5年定期預金開設'),
('T20250014', 'C0014', '2025-02-25', '入金', 200000.00, 200000.00, 'モバイルアプリ', 'BR007', '新規口座開設'),
('T20250015', 'C0015', '2025-02-28', '出金', 100000.00, 650000.00, 'Web', 'BR003', 'カードローン借入'),
('T20250016', 'C0016', '2025-03-02', '入金', 450000.00, 3350000.00, 'モバイルアプリ', 'BR001', '給与振込'),
('T20250017', 'C0017', '2025-03-06', '振込', 120000.00, 530000.00, 'Web', 'BR008', '保険料支払い'),
('T20250018', 'C0018', '2025-03-10', '入金', 180000.00, 180000.00, 'ATM', 'BR002', '初回入金'),
('T20250019', 'C0019', '2025-03-12', '定期預金', 800000.00, 4200000.00, 'Web', 'BR009', '1年定期預金開設'),
('T20250020', 'C0020', '2025-03-15', '出金', 60000.00, 590000.00, 'ATM', 'BR003', '生活費'),
('T20250021', 'C0021', '2025-03-18', '入金', 270000.00, 820000.00, 'モバイルアプリ', 'BR010', '給与振込'),
('T20250022', 'C0022', '2025-03-20', '定期預金', 300000.00, 3800000.00, 'Web', 'BR001', '外貨預金追加'),
('T20250023', 'C0023', '2025-03-22', '入金', 220000.00, 220000.00, 'モバイルアプリ', 'BR011', '新規口座開設'),
('T20250024', 'C0024', '2025-03-25', '投資信託', 80000.00, 730000.00, 'Web', 'BR002', '国内株式投信購入'),
('T20250025', 'C0025', '2025-03-28', '入金', 600000.00, 9700000.00, 'Web', 'BR001', '役員報酬振込'),
('T20250026', 'C0026', '2025-04-02', '入金', 260000.00, 910000.00, 'モバイルアプリ', 'BR012', '給与振込'),
('T20250027', 'C0027', '2025-04-06', '定期預金', 30000.00, 680000.00, 'Web', 'BR003', '積立定期自動引落'),
('T20250028', 'C0028', '2025-04-10', '入金', 190000.00, 190000.00, 'ATM', 'BR013', '初回入金'),
('T20250029', 'C0029', '2025-04-12', '投資信託', 250000.00, 4550000.00, 'Web', 'BR001', '海外株式投信購入'),
('T20250030', 'C0030', '2025-04-15', '振込', 90000.00, 610000.00, 'モバイルアプリ', 'BR014', '公共料金支払い'),
('T20250031', 'C0001', '2025-04-18', '入金', 500000.00, 3000000.00, 'モバイルアプリ', 'BR001', '給与振込'),
('T20250032', 'C0002', '2025-04-20', '投資信託', 120000.00, 570000.00, 'Web', 'BR002', 'バランス型投信購入'),
('T20250033', 'C0031', '2025-04-22', '入金', 290000.00, 890000.00, 'モバイルアプリ', 'BR015', '給与振込'),
('T20250034', 'C0032', '2025-04-25', '入金', 210000.00, 210000.00, 'モバイルアプリ', 'BR016', '新規口座開設'),
('T20250035', 'C0033', '2025-04-28', '定期預金', 1500000.00, 6200000.00, 'Web', 'BR001', '3年定期預金開設'),
('T20250036', 'C0003', '2025-05-02', '入金', 520000.00, 4020000.00, 'モバイルアプリ', 'BR001', '給与振込'),
('T20250037', 'C0004', '2025-05-06', '投資信託', 100000.00, 650000.00, 'Web', 'BR003', '国内株式投信追加購入'),
('T20250038', 'C0034', '2025-05-10', '入金', 280000.00, 830000.00, 'モバイルアプリ', 'BR017', '給与振込'),
('T20250039', 'C0035', '2025-05-12', '定期預金', 500000.00, 1330000.00, 'Web', 'BR018', '1年定期預金開設'),
('T20250040', 'C0005', '2025-05-15', '出金', 50000.00, 250000.00, 'ATM', 'BR004', '生活費'),
('T20250041', 'C0006', '2025-05-18', '入金', 480000.00, 3280000.00, 'モバイルアプリ', 'BR001', '給与振込'),
('T20250042', 'C0007', '2025-05-20', '定期預金', 50000.00, 770000.00, 'Web', 'BR001', '積立定期自動引落'),
('T20250043', 'C0008', '2025-05-22', '振込', 100000.00, 550000.00, 'Web', 'BR005', '家賃支払い'),
('T20250044', 'C0009', '2025-05-25', '投資信託', 70000.00, 320000.00, 'Web', 'BR002', '国内株式投信購入'),
('T20250045', 'C0010', '2025-05-28', '入金', 470000.00, 3670000.00, 'モバイルアプリ', 'BR001', '配当金入金'),
('T20250046', 'C0036', '2025-06-02', '入金', 300000.00, 300000.00, 'モバイルアプリ', 'BR019', '新規口座開設'),
('T20250047', 'C0037', '2025-06-06', '入金', 280000.00, 280000.00, 'モバイルアプリ', 'BR020', '給与振込'),
('T20250048', 'C0038', '2025-06-10', '入金', 220000.00, 220000.00, 'ATM', 'BR021', '初回入金'),
('T20250049', 'C0039', '2025-06-12', '入金', 550000.00, 550000.00, 'Web', 'BR022', '役員報酬振込'),
('T20250050', 'C0040', '2025-06-15', '入金', 310000.00, 310000.00, 'モバイルアプリ', 'BR023', '給与振込'),
('T20250051', 'C0041', '2025-06-18', '入金', 500000.00, 500000.00, 'Web', 'BR024', '給与振込'),
('T20250052', 'C0042', '2025-06-20', '入金', 270000.00, 270000.00, 'モバイルアプリ', 'BR025', '給与振込'),
('T20250053', 'C0043', '2025-06-22', '入金', 290000.00, 290000.00, 'モバイルアプリ', 'BR026', '給与振込'),
('T20250054', 'C0044', '2025-06-25', '入金', 450000.00, 450000.00, 'Web', 'BR027', '給与振込'),
('T20250055', 'C0045', '2025-06-28', '入金', 280000.00, 280000.00, 'モバイルアプリ', 'BR028', '給与振込'),
('T20250056', 'C0046', '2025-07-02', '入金', 300000.00, 300000.00, 'モバイルアプリ', 'BR029', '給与振込'),
('T20250057', 'C0047', '2025-07-06', '入金', 520000.00, 520000.00, 'Web', 'BR030', '役員報酬振込'),
('T20250058', 'C0048', '2025-07-10', '入金', 200000.00, 200000.00, 'ATM', 'BR031', '初回入金'),
('T20250059', 'C0049', '2025-07-12', '入金', 330000.00, 330000.00, 'モバイルアプリ', 'BR032', '給与振込'),
('T20250060', 'C0050', '2025-07-15', '入金', 410000.00, 410000.00, 'Web', 'BR033', '給与振込'),
('T20250061', 'C0011', '2025-07-18', '入金', 280000.00, 860000.00, 'モバイルアプリ', 'BR006', '給与振込'),
('T20250062', 'C0012', '2025-07-20', '投資信託', 100000.00, 900000.00, 'Web', 'BR002', 'バランス型投信追加購入'),
('T20250063', 'C0013', '2025-07-22', '入金', 550000.00, 9050000.00, 'Web', 'BR001', '役員報酬振込'),
('T20250064', 'C0014', '2025-07-25', '定期預金', 30000.00, 230000.00, 'Web', 'BR007', '積立定期開始'),
('T20250065', 'C0015', '2025-07-28', '入金', 50000.00, 700000.00, 'Web', 'BR003', '返済'),
('T20250066', 'C0016', '2025-08-01', '入金', 450000.00, 3730000.00, 'モバイルアプリ', 'BR001', '給与振込'),
('T20250067', 'C0017', '2025-08-05', '出金', 80000.00, 570000.00, 'ATM', 'BR008', '生活費'),
('T20250068', 'C0018', '2025-08-10', '投資信託', 60000.00, 240000.00, 'Web', 'BR002', '国内株式投信購入'),
('T20250069', 'C0019', '2025-08-12', '入金', 490000.00, 4690000.00, 'モバイルアプリ', 'BR009', '給与振込'),
('T20250070', 'C0020', '2025-08-15', '投資信託', 150000.00, 740000.00, 'Web', 'BR003', '海外株式投信購入'),
('T20250071', 'C0021', '2025-08-18', '入金', 300000.00, 1160000.00, 'モバイルアプリ', 'BR010', '給与振込＋賞与'),
('T20250072', 'C0022', '2025-08-20', '入金', 500000.00, 4300000.00, 'モバイルアプリ', 'BR001', '賞与振込'),
('T20250073', 'C0023', '2025-08-22', '入金', 250000.00, 470000.00, 'モバイルアプリ', 'BR011', '給与振込'),
('T20250074', 'C0024', '2025-08-25', '投資信託', 100000.00, 830000.00, 'Web', 'BR002', '国内株式投信購入'),
('T20250075', 'C0025', '2025-08-28', '入金', 800000.00, 10500000.00, 'Web', 'BR001', '役員報酬＋賞与'),
('T20250076', 'C0026', '2025-09-01', '入金', 260000.00, 1170000.00, 'モバイルアプリ', 'BR012', '給与振込'),
('T20250077', 'C0027', '2025-09-05', '定期預金', 30000.00, 710000.00, 'Web', 'BR003', '積立定期自動引落'),
('T20250078', 'C0028', '2025-09-10', '投資信託', 80000.00, 270000.00, 'Web', 'BR013', 'バランス型投信購入'),
('T20250079', 'C0029', '2025-09-12', '入金', 510000.00, 5060000.00, 'モバイルアプリ', 'BR001', '給与振込'),
('T20250080', 'C0030', '2025-09-15', '振込', 95000.00, 615000.00, 'Web', 'BR014', 'クレジットカード引落'),
('T20250081', 'C0001', '2025-09-18', '入金', 500000.00, 3500000.00, 'モバイルアプリ', 'BR001', '給与振込'),
('T20250082', 'C0002', '2025-09-20', '定期預金', 200000.00, 770000.00, 'Web', 'BR002', '外貨預金開設'),
('T20250083', 'C0031', '2025-09-22', '入金', 290000.00, 1180000.00, 'モバイルアプリ', 'BR015', '給与振込'),
('T20250084', 'C0032', '2025-09-25', '投資信託', 90000.00, 300000.00, 'Web', 'BR016', '国内株式投信購入'),
('T20250085', 'C0033', '2025-09-28', '入金', 530000.00, 6730000.00, 'モバイルアプリ', 'BR001', '給与振込'),
('T20250086', 'C0003', '2025-10-01', '入金', 520000.00, 4540000.00, 'モバイルアプリ', 'BR001', '給与振込'),
('T20250087', 'C0004', '2025-10-05', '投資信託', 120000.00, 770000.00, 'Web', 'BR003', 'バランス型投信購入'),
('T20250088', 'C0034', '2025-10-10', '入金', 280000.00, 1110000.00, 'モバイルアプリ', 'BR017', '給与振込'),
('T20250089', 'C0035', '2025-10-12', '振込', 150000.00, 1180000.00, 'Web', 'BR018', '仕送り'),
('T20250090', 'C0005', '2025-10-15', '定期預金', 200000.00, 450000.00, 'Web', 'BR004', '1年定期預金開設'),
('T20250091', 'C0006', '2025-10-18', '入金', 480000.00, 3760000.00, 'モバイルアプリ', 'BR001', '給与振込'),
('T20250092', 'C0007', '2025-10-20', '振込', 80000.00, 690000.00, 'モバイルアプリ', 'BR001', '家賃支払い'),
('T20250093', 'C0008', '2025-10-22', '定期預金', 50000.00, 600000.00, 'Web', 'BR005', '積立定期自動引落'),
('T20250094', 'C0009', '2025-10-25', '入金', 270000.00, 590000.00, 'モバイルアプリ', 'BR002', '給与振込'),
('T20250095', 'C0010', '2025-10-28', '投資信託', 200000.00, 3870000.00, 'Web', 'BR001', '海外株式投信購入'),
('T20250096', 'C0036', '2025-11-01', '入金', 300000.00, 600000.00, 'モバイルアプリ', 'BR019', '給与振込'),
('T20250097', 'C0037', '2025-11-05', '出金', 50000.00, 230000.00, 'ATM', 'BR020', '生活費'),
('T20250098', 'C0038', '2025-11-10', '定期預金', 100000.00, 320000.00, 'Web', 'BR021', '定期預金開設'),
('T20250099', 'C0039', '2025-11-12', '入金', 550000.00, 1100000.00, 'Web', 'BR022', '役員報酬振込'),
('T20250100', 'C0040', '2025-11-15', '振込', 80000.00, 230000.00, 'モバイルアプリ', 'BR023', '公共料金'),
('T20250101', 'C0041', '2025-11-18', '入金', 500000.00, 1000000.00, 'Web', 'BR024', '給与振込'),
('T20250102', 'C0042', '2025-11-20', '投資信託', 100000.00, 370000.00, 'Web', 'BR025', '投資信託購入'),
('T20250103', 'C0043', '2025-11-22', '入金', 290000.00, 580000.00, 'モバイルアプリ', 'BR026', '給与振込'),
('T20250104', 'C0044', '2025-11-25', '出金', 80000.00, 370000.00, 'ATM', 'BR027', '生活費'),
('T20250105', 'C0045', '2025-11-28', '入金', 280000.00, 560000.00, 'モバイルアプリ', 'BR028', '給与振込'),
('T20250106', 'C0046', '2025-12-01', '入金', 300000.00, 600000.00, 'モバイルアプリ', 'BR029', '給与振込'),
('T20250107', 'C0047', '2025-12-05', '入金', 520000.00, 1040000.00, 'Web', 'BR030', '役員報酬振込'),
('T20250108', 'C0048', '2025-12-10', '定期預金', 150000.00, 350000.00, 'Web', 'BR031', '定期預金開設'),
('T20250109', 'C0049', '2025-12-12', '入金', 330000.00, 660000.00, 'モバイルアプリ', 'BR032', '給与振込'),
('T20250110', 'C0050', '2025-12-15', '投資信託', 120000.00, 530000.00, 'Web', 'BR033', '投資信託購入'),
('T20250111', 'C0011', '2025-12-18', '入金', 280000.00, 1140000.00, 'モバイルアプリ', 'BR006', '給与振込'),
('T20250112', 'C0012', '2025-12-20', '出金', 100000.00, 800000.00, 'ATM', 'BR002', '旅行資金'),
('T20250113', 'C0013', '2025-12-22', '定期預金', 500000.00, 9550000.00, 'Web', 'BR001', '外貨預金開設'),
('T20250114', 'C0014', '2025-12-25', '投資信託', 70000.00, 300000.00, 'Web', 'BR007', '国内株式投信購入'),
('T20250115', 'C0015', '2025-12-28', '入金', 310000.00, 1010000.00, 'モバイルアプリ', 'BR003', '給与振込'),
('T20250116', 'C0016', '2025-01-03', '入金', 450000.00, 4210000.00, 'モバイルアプリ', 'BR001', '給与振込'),
('T20250117', 'C0017', '2025-01-10', '投資信託', 100000.00, 650000.00, 'Web', 'BR008', 'バランス型投信購入'),
('T20250118', 'C0018', '2025-01-15', '入金', 200000.00, 440000.00, 'モバイルアプリ', 'BR002', '給与振込'),
('T20250119', 'C0019', '2025-02-03', '入金', 490000.00, 5180000.00, 'モバイルアプリ', 'BR009', '給与振込'),
('T20250120', 'C0020', '2025-02-10', '投資信託', 150000.00, 890000.00, 'Web', 'BR003', '国内株式投信購入'),
('T20250121', 'C0021', '2025-03-05', '入金', 280000.00, 1420000.00, 'モバイルアプリ', 'BR010', '給与振込'),
('T20250122', 'C0022', '2025-03-10', '入金', 450000.00, 4750000.00, 'モバイルアプリ', 'BR001', '給与振込'),
('T20250123', 'C0023', '2025-04-02', '定期預金', 30000.00, 500000.00, 'Web', 'BR011', '積立定期自動引落'),
('T20250124', 'C0024', '2025-04-10', '投資信託', 120000.00, 950000.00, 'Web', 'BR002', '海外株式投信購入'),
('T20250125', 'C0025', '2025-04-15', '入金', 600000.00, 11150000.00, 'Web', 'BR001', '役員報酬振込'),
('T20250126', 'C0026', '2025-05-02', '振込', 90000.00, 1080000.00, 'Web', 'BR012', '保険料支払い'),
('T20250127', 'C0027', '2025-05-10', '入金', 320000.00, 1030000.00, 'モバイルアプリ', 'BR003', '給与振込'),
('T20250128', 'C0028', '2025-06-01', '出金', 60000.00, 210000.00, 'ATM', 'BR013', '生活費'),
('T20250129', 'C0029', '2025-06-05', '定期預金', 300000.00, 5360000.00, 'Web', 'BR001', '定期預金開設'),
('T20250130', 'C0030', '2025-07-02', '入金', 330000.00, 945000.00, 'モバイルアプリ', 'BR014', '給与振込'),
('T20250131', 'C0031', '2025-07-10', '投資信託', 150000.00, 1330000.00, 'Web', 'BR015', '投資信託購入'),
('T20250132', 'C0032', '2025-08-01', '入金', 210000.00, 510000.00, 'モバイルアプリ', 'BR016', '給与振込'),
('T20250133', 'C0033', '2025-08-05', '振込', 120000.00, 6610000.00, 'Web', 'BR001', '支払'),
('T20250134', 'C0034', '2025-09-01', '入金', 280000.00, 1390000.00, 'モバイルアプリ', 'BR017', '給与振込'),
('T20250135', 'C0035', '2025-09-10', '出金', 100000.00, 1080000.00, 'ATM', 'BR018', '生活費'),
('T20250136', 'C0036', '2025-10-01', '定期預金', 200000.00, 800000.00, 'Web', 'BR019', '定期預金開設'),
('T20250137', 'C0037', '2025-10-10', '入金', 280000.00, 510000.00, 'モバイルアプリ', 'BR020', '給与振込'),
('T20250138', 'C0038', '2025-11-01', '投資信託', 100000.00, 420000.00, 'Web', 'BR021', '投資信託購入'),
('T20250139', 'C0039', '2025-11-10', '入金', 550000.00, 1650000.00, 'Web', 'BR022', '役員報酬振込'),
('T20250140', 'C0040', '2025-12-01', '振込', 85000.00, 315000.00, 'モバイルアプリ', 'BR023', '家賃支払い'),
('T20250141', 'C0041', '2025-12-05', '出金', 80000.00, 920000.00, 'ATM', 'BR024', '生活費'),
('T20250142', 'C0042', '2025-12-10', '入金', 270000.00, 640000.00, 'モバイルアプリ', 'BR025', '給与振込'),
('T20250143', 'C0043', '2025-12-15', '定期預金', 150000.00, 730000.00, 'Web', 'BR026', '定期預金開設'),
('T20250144', 'C0044', '2025-12-18', '入金', 450000.00, 820000.00, 'Web', 'BR027', '給与振込'),
('T20250145', 'C0045', '2025-12-20', '投資信託', 90000.00, 650000.00, 'Web', 'BR028', '投資信託購入'),
('T20250146', 'C0046', '2025-12-22', '入金', 300000.00, 900000.00, 'モバイルアプリ', 'BR029', '給与振込'),
('T20250147', 'C0047', '2025-12-25', '出金', 100000.00, 940000.00, 'ATM', 'BR030', '年末資金'),
('T20250148', 'C0048', '2025-12-27', '振込', 70000.00, 280000.00, 'Web', 'BR031', '支払'),
('T20250149', 'C0049', '2025-12-28', '入金', 330000.00, 990000.00, 'モバイルアプリ', 'BR032', '給与振込'),
('T20250150', 'C0050', '2025-12-30', '定期預金', 200000.00, 730000.00, 'Web', 'BR033', '年末定期預金');

-- 4.SiSアプリのデプロイ
-- デプロイ先のSchema配下にSiSコード配置用ステージ作成
create or replace stage bank_db.bank_schema.bank_app_stage directory = (enable = true); --db_nameとschema_name部分は書き換えて利用ください
ALTER ACCOUNT SET CORTEX_ENABLED_CROSS_REGION = 'ANY_REGION';

-- API連携
CREATE OR REPLACE API INTEGRATION git_api_integration
  API_PROVIDER = git_https_api
  API_ALLOWED_PREFIXES = ('https://github.com/kmotokubota/')
  ENABLED = TRUE;

-- Git連携
CREATE OR REPLACE GIT REPOSITORY GIT_INTEGRATION_FOR_HANDSON
  API_INTEGRATION = git_api_integration
  ORIGIN = 'https://github.com/kmotokubota/simple_serach_streamlit_app.git';

-- Gitのソースコードを元にStreamlit in Snowflakeの作成
CREATE OR REPLACE STREAMLIT simple_search_app
    FROM @GIT_INTEGRATION_FOR_HANDSON/branches/main/simple_search_app
    MAIN_FILE = 'streamlit_app.py'
    QUERY_WAREHOUSE = COMPUTE_WH;

-- ========================================
-- 5.セマンティックビュー作成
-- ========================================
USE DATABASE application_db;
CREATE OR REPLACE SCHEMA application_db.semantic_view_schema;

CREATE OR REPLACE SEMANTIC VIEW application_db.semantic_view_schema.BANK_SEMANTIC_VIEW

  TABLES (
    customers AS BANK_DB.BANK_SCHEMA.CUSTOMER
      PRIMARY KEY (CUSTOMER_ID)
      WITH SYNONYMS = ('顧客', 'お客様', 'ユーザー')
      COMMENT = '銀行の顧客マスタテーブル。顧客の基本情報、セグメント、口座状態を管理',
    transactions AS BANK_DB.BANK_SCHEMA.TRANSACTION
      PRIMARY KEY (TRANSACTION_ID)
      WITH SYNONYMS = ('取引', 'トランザクション', '取引履歴')
      COMMENT = '取引履歴テーブル。入金、出金、振込、定期預金、投資信託などの取引を記録'
  )

  RELATIONSHIPS (
    transactions_to_customers AS
      transactions (CUSTOMER_ID) REFERENCES customers (CUSTOMER_ID)
  )

  FACTS (
    customers.age AS AGE
      COMMENT = '顧客の年齢',
    transactions.amount AS AMOUNT
      WITH SYNONYMS = ('金額', '取引金額')
      COMMENT = '取引金額',
    transactions.balance_after AS BALANCE_AFTER
      WITH SYNONYMS = ('残高', '取引後残高')
      COMMENT = '取引後残高',
    transactions.deposit_amount AS CASE WHEN TRANSACTION_TYPE = '入金' THEN AMOUNT ELSE 0 END
      COMMENT = '入金金額',
    transactions.withdrawal_amount AS CASE WHEN TRANSACTION_TYPE = '出金' THEN AMOUNT ELSE 0 END
      COMMENT = '出金金額',
    transactions.transfer_amount AS CASE WHEN TRANSACTION_TYPE = '振込' THEN AMOUNT ELSE 0 END
      COMMENT = '振込金額',
    transactions.investment_amount AS CASE WHEN TRANSACTION_TYPE = '投資信託' THEN AMOUNT ELSE 0 END
      COMMENT = '投資信託金額',
    transactions.time_deposit_amount AS CASE WHEN TRANSACTION_TYPE = '定期預金' THEN AMOUNT ELSE 0 END
      COMMENT = '定期預金金額'
  )

  DIMENSIONS (
    customers.customer_id AS CUSTOMER_ID
      WITH SYNONYMS = ('顧客ID', '顧客番号')
      COMMENT = '顧客の一意識別子',
    customers.customer_name AS CUSTOMER_NAME
      WITH SYNONYMS = ('顧客名', '氏名', '名前')
      COMMENT = '顧客の氏名',
    customers.customer_name_kana AS CUSTOMER_NAME_KANA
      WITH SYNONYMS = ('カナ', 'フリガナ')
      COMMENT = '顧客の氏名（カナ）',
    customers.gender AS GENDER
      WITH SYNONYMS = ('性別')
      COMMENT = '性別（男性/女性）',
    customers.prefecture AS PREFECTURE
      WITH SYNONYMS = ('都道府県', '地域')
      COMMENT = '都道府県',
    customers.city AS CITY
      WITH SYNONYMS = ('市区町村', '市')
      COMMENT = '市区町村',
    customers.customer_segment AS CUSTOMER_SEGMENT
      WITH SYNONYMS = ('顧客セグメント', 'セグメント', '顧客区分')
      COMMENT = '顧客セグメント（プレミアム/スタンダード/新規）',
    customers.account_status AS ACCOUNT_STATUS
      WITH SYNONYMS = ('口座状態', 'ステータス')
      COMMENT = '口座状態（アクティブ/休眠/解約）',
    customers.registration_date AS REGISTRATION_DATE
      WITH SYNONYMS = ('登録日', '口座開設日')
      COMMENT = '口座開設日・登録日',
    transactions.transaction_id AS TRANSACTION_ID
      WITH SYNONYMS = ('取引ID', '取引番号')
      COMMENT = '取引の一意識別子',
    transactions.transaction_date AS TRANSACTION_DATE
      WITH SYNONYMS = ('取引日', '日付')
      COMMENT = '取引日',
    transactions.transaction_type AS TRANSACTION_TYPE
      WITH SYNONYMS = ('取引種別', '取引タイプ')
      COMMENT = '取引種別（入金/出金/振込/定期預金/投資信託）',
    transactions.channel AS CHANNEL
      WITH SYNONYMS = ('チャネル', '取引チャネル')
      COMMENT = '取引チャネル（Web/モバイルアプリ/ATM/コールセンター）',
    transactions.branch_code AS BRANCH_CODE
      WITH SYNONYMS = ('支店コード', '支店')
      COMMENT = '支店コード',
    transactions.memo AS MEMO
      WITH SYNONYMS = ('メモ', '摘要')
      COMMENT = '取引メモ・摘要',
    transactions.transaction_month AS DATE_TRUNC('MONTH', TRANSACTION_DATE)
      WITH SYNONYMS = ('取引月', '月')
      COMMENT = '取引月'
  )

  METRICS (
    customers.total_customers AS COUNT(DISTINCT customers.CUSTOMER_ID)
      WITH SYNONYMS = ('顧客数', '顧客総数')
      COMMENT = '総顧客数',
    customers.average_age AS AVG(customers.age)
      WITH SYNONYMS = ('平均年齢')
      COMMENT = '平均年齢',
    transactions.total_amount AS SUM(transactions.amount)
      WITH SYNONYMS = ('取引金額合計', '合計金額')
      COMMENT = '総取引金額',
    transactions.average_amount AS AVG(transactions.amount)
      WITH SYNONYMS = ('平均金額', '平均取引額')
      COMMENT = '平均取引金額',
    transactions.transaction_count AS COUNT(transactions.TRANSACTION_ID)
      WITH SYNONYMS = ('取引数', '件数')
      COMMENT = '取引件数',
    transactions.total_deposits AS SUM(transactions.deposit_amount)
      WITH SYNONYMS = ('入金額', '入金合計')
      COMMENT = '入金合計',
    transactions.total_withdrawals AS SUM(transactions.withdrawal_amount)
      WITH SYNONYMS = ('出金額', '出金合計')
      COMMENT = '出金合計',
    transactions.total_transfers AS SUM(transactions.transfer_amount)
      WITH SYNONYMS = ('振込額', '振込合計')
      COMMENT = '振込合計',
    transactions.total_investments AS SUM(transactions.investment_amount)
      WITH SYNONYMS = ('投資額', '投資信託合計')
      COMMENT = '投資信託購入合計',
    transactions.total_time_deposits AS SUM(transactions.time_deposit_amount)
      WITH SYNONYMS = ('定期預金額')
      COMMENT = '定期預金合計'
  )

  COMMENT = 'ネット銀行の顧客・取引分析用セマンティックビュー';
